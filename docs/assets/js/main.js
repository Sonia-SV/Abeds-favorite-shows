"use strict";let searchShows=[],favShows=[];const searchInput=document.querySelector(".js-search"),mainPage=document.querySelector(".js-main-results"),searchButton=document.querySelector(".js-search-button"),favListContainer=document.createElement("div"),searchList=document.createElement("ul"),favList=document.createElement("ul");searchList.setAttribute("class","main__results__search"),favList.setAttribute("class","main__results__fav"),mainPage.appendChild(favListContainer),mainPage.appendChild(searchList),favListContainer.appendChild(favList);const resetItem=document.createElement("div"),reset=document.createTextNode("DALE A RESET");resetItem.setAttribute("class","js-button-reset"),favListContainer.appendChild(resetItem),resetItem.appendChild(reset);const handleSearchButton=e=>{e.preventDefault(),resetSearch(),getShowsFromApi()},resetSearch=()=>{searchShows=[],searchList.innerHTML=""},getShowsFromApi=()=>{let e=searchInput.value;fetch("http://api.tvmaze.com/search/shows?q="+e).then(e=>e.json()).then(e=>{0===e.length&&console.log("La bÃºsqueda no ha dado resultados");for(const t of e)null!==t.show.image?searchShows.push({id:t.show.id,name:t.show.name,img:t.show.image.medium,fav:!1}):searchShows.push({id:t.show.id,name:t.show.name,img:"https://via.placeholder.com/210x295/555555/FFFFFF/?text=OPS!+:)",fav:!1});updateFavSearch(),paintShows()})},paintShows=()=>{searchList.innerHTML="";for(const e of searchShows){const t=document.createElement("li");searchList.appendChild(t),t.setAttribute("id",e.id),t.setAttribute("class","js-item"),!0===e.fav?t.classList.add("js-fav-item"):!1===e.fav&&t.classList.remove("js-fav-item");const a=document.createElement("h3"),s=document.createTextNode(e.name);t.appendChild(a),a.appendChild(s);const n=document.createElement("img");n.setAttribute("src",e.img),t.appendChild(n),listenFavClicks()}};searchButton.addEventListener("click",handleSearchButton);const handleShowFav=e=>{const t=parseInt(e.currentTarget.id),a=searchShows.find(e=>e.id===t),s=favShows.find(e=>e.id===t);if(void 0===s)a.fav=!0,favShows.push(a);else{const e=favShows.indexOf(s);favShows.splice(e,1),a.fav=!1}updateFavSearch(),paintShows(),updateLocalStorage(),paintFavList()},listenFavClicks=()=>{const e=document.querySelectorAll(".js-item");for(let t=0;t<e.length;t++){e[t].addEventListener("click",handleShowFav)}},updateLocalStorage=()=>{localStorage.setItem("fav",JSON.stringify(favShows))},getFromLocalStorage=()=>{const e=JSON.parse(localStorage.getItem("fav"));null!==e&&(favShows=e),paintFavList()},paintFavList=()=>{favList.innerHTML="";for(const e of favShows){const t=document.createElement("li");favList.appendChild(t),t.setAttribute("id",e.id),t.setAttribute("class","js-fav");const a=document.createElement("h4"),s=document.createTextNode(e.name);t.appendChild(a),a.appendChild(s);const n=document.createElement("img");n.setAttribute("src",e.img),t.appendChild(n);const o=document.createElement("span");o.setAttribute("class","js-fav-delete"),o.setAttribute("id",e.id);const i=document.createElement("i");i.setAttribute("class","far fa-times-circle"),o.appendChild(i),t.appendChild(o)}listenDeleteFav(),updateFavSearch(),paintShows()};function updateFavSearch(){for(const e of favShows){const t=searchShows.find(t=>t.id===e.id);void 0!==t&&(t.fav=!0)}}const handleDeleteFav=e=>{const t=parseInt(e.currentTarget.id),a=favShows.find(e=>e.id===t),s=favShows.indexOf(a);favShows.splice(s,1),paintFavList(),updateLocalStorage(),deleteFavSearch(),paintShows()},listenDeleteFav=()=>{const e=document.querySelectorAll(".js-fav-delete");for(let t=0;t<e.length;t++){e[t].addEventListener("click",handleDeleteFav)}};function deleteFavSearch(){for(const e of searchShows)if(!0===e.fav){void 0===favShows.find(t=>t.id===e.id)&&(e.fav=!1)}paintShows()}const btnReset=document.querySelector(".js-button-reset"),resetFavs=()=>{favShows=[],updateLocalStorage(),paintFavList(),deleteFavSearch()};btnReset.addEventListener("click",resetFavs),paintFavList(),paintShows(),getFromLocalStorage();