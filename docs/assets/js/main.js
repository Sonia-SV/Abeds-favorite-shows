"use strict";const placeImg="./assets/images/Cornelius.png",formSubmit=document.querySelector(".js-form"),searchInput=document.querySelector(".js-search"),favList=document.querySelector(".js-fav-list"),searchList=document.querySelector(".js-search-list"),tvFav=document.querySelector(".js-tv-fav"),searchButton=document.querySelector(".js-search-button"),tvButton=document.querySelector(".js-tv-fav-btn"),errorSearch=document.querySelector(".js-error-message"),favsWarning=document.querySelector(".js-fav-message");let searchShows=[],favShows=[];const handleSearchButton=e=>{e.preventDefault(),resetSearch(),getShowsFromApi()},resetSearch=()=>{searchShows=[],searchList.innerHTML=""},getShowsFromApi=()=>{let e=searchInput.value;fetch("http://api.tvmaze.com/search/shows?q="+e).then(e=>e.json()).then(e=>{for(const t of e)searchShows.push({id:t.show.id,name:t.show.name,img:null!==t.show.image?t.show.image.medium:placeImg,fav:!1});paintError(e),updateFavSearch(),paintShows()})},paintError=e=>{0===e.length?errorSearch.innerHTML="We can't find nothing, try again!":errorSearch.innerHTML=""},paintShows=()=>{searchList.innerHTML="";for(const e of searchShows){const t=document.createElement("li");searchList.appendChild(t),t.setAttribute("id",e.id),t.setAttribute("class","js-item"),!0===e.fav?t.classList.add("js-fav-item"):!1===e.fav&&t.classList.remove("js-fav-item");const a=document.createElement("h3");a.setAttribute("class","h3");const s=document.createTextNode(e.name);t.appendChild(a),a.appendChild(s);const n=document.createElement("div"),o=document.createElement("img");o.setAttribute("src",e.img),n.appendChild(o),t.appendChild(n),listenFavClicks(),paintCommunityCast(e,n)}};formSubmit.addEventListener("submit",handleSearchButton),searchButton.addEventListener("click",handleSearchButton);const handleShowFav=e=>{const t=parseInt(e.currentTarget.id),a=searchShows.find(e=>e.id===t),s=favShows.find(e=>e.id===t);if(void 0===s)a.fav=!0,favShows.push(a);else{const e=favShows.indexOf(s);favShows.splice(e,1),a.fav=!1}updateFavSearch(),paintShows(),updateLocalStorage(),paintFavList()},listenFavClicks=()=>{const e=document.querySelectorAll(".js-item");for(let t=0;t<e.length;t++){e[t].addEventListener("click",handleShowFav)}},updateLocalStorage=()=>{localStorage.setItem("fav",JSON.stringify(favShows))},getFromLocalStorage=()=>{const e=JSON.parse(localStorage.getItem("fav"));null!==e&&(favShows=e),recountFav(),nameFavButton(),paintFavList()},paintFavList=()=>{favList.innerHTML="";for(const e of favShows){const t=document.createElement("li");favList.appendChild(t),t.setAttribute("id",e.id),t.setAttribute("class","js-fav");const a=document.createElement("h4"),s=document.createTextNode(e.name);t.appendChild(a),a.appendChild(s);const n=document.createElement("div"),o=document.createElement("img");o.setAttribute("src",e.img),n.appendChild(o),t.appendChild(n);const i=document.createElement("span");i.setAttribute("class","js-fav-delete"),i.setAttribute("id",e.id);const r=document.createElement("i");r.setAttribute("class","far fa-times-circle"),i.appendChild(r),t.appendChild(i)}listenDeleteFav(),recountFav(),updateFavSearch(),paintShows()},recountFav=()=>{favShows.length<1?tvFav.innerHTML="Abed's favorite list is empty":1===favShows.length?tvFav.innerHTML=`"${favShows[0].name}" is now Abed's favorite`:favShows.length>1&&(tvFav.innerHTML=`"${favShows[0].name}" and ${favShows.length-1} more are now Abed's favorites`)};function updateFavSearch(){for(const e of favShows){const t=searchShows.find(t=>t.id===e.id);void 0!==t&&(t.fav=!0)}}const handleDeleteFav=e=>{const t=parseInt(e.currentTarget.id),a=favShows.find(e=>e.id===t),s=favShows.indexOf(a);favShows.splice(s,1),paintFavList(),favListMessage(),updateLocalStorage(),deleteFavSearch(),paintShows()},listenDeleteFav=()=>{const e=document.querySelectorAll(".js-fav-delete");for(let t=0;t<e.length;t++){e[t].addEventListener("click",handleDeleteFav)}};function deleteFavSearch(){for(const e of searchShows)if(!0===e.fav){void 0===favShows.find(t=>t.id===e.id)&&(e.fav=!1)}paintShows()}const btnReset=document.querySelector(".js-button-reset"),resetFavs=()=>{favShows=[],updateLocalStorage(),paintFavList(),deleteFavSearch(),recountFav(),nameFavButton(),closeFavs()};btnReset.addEventListener("click",resetFavs);const btnFavs=document.querySelector(".js-favs-toggle"),favToggle=document.querySelector(".js-fav-results"),searchToggle=document.querySelector(".js-search-results"),openFavs=()=>{favToggle.classList.toggle("js-fav-open"),searchToggle.classList.toggle("js-close"),favListMessage(),nameFavButton()},favListMessage=()=>{favToggle.classList.contains("js-fav-open")&&(0===favShows.length?favsWarning.innerHTML="oh no! Abed's show list seems to be empty!":favsWarning.innerHTML="")};btnFavs.addEventListener("click",openFavs);const closeFavs=()=>{favToggle.classList.remove("js-fav-open"),searchToggle.classList.remove("js-close"),nameFavButton()},nameFavButton=()=>{favToggle.classList.contains("js-fav-open")?tvButton.innerHTML="Close favorites":tvButton.innerHTML="Open favorites"},paintCommunityCast=(e,t)=>{if(17869===e.id){const e=document.createElement("div");t.appendChild(e),e.classList.add("js-annie-frame")}if(6765===e.id){const e=document.createElement("div");t.appendChild(e),e.classList.add("js-britta-frame")}if(6508===e.id){const e=document.createElement("div");t.appendChild(e),e.classList.add("js-troy-frame")}if(34453===e.id){const e=document.createElement("div");t.appendChild(e),e.classList.add("js-jeff-frame")}if(361===e.id){const e=document.createElement("div");t.appendChild(e),e.classList.add("js-pierce-frame")}if(988===e.id){const e=document.createElement("div");t.appendChild(e),e.classList.add("js-shirley-frame")}};recountFav(),paintFavList(),paintShows(),getFromLocalStorage();